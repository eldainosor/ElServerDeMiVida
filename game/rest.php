<?php
	if ($_SERVER['REQUEST_METHOD'] === 'POST') {
		// Primero, vamos a guardar un registro en json berreta
		// de las peticiones que haga la criatura
		// (la criatura en este caso es erdtv.exe)
		$conexionDatos = new mysqli('localhost', 'root', '', 'erdtv_log_requests');

		// Vamos filtrando la data que meta en la peticion POST
		$output = "";
		foreach ($_POST as $key => $value) {
			$output = $key . ": " . $value;
		}
		$tmstmp = time();
		// Vamos a guardar las peticiones que haga el juego en nuestra db
		$gameRequestRequest = "INSERT INTO `peticiones`(`timestamp`,`outputdata`) VALUES ('$tmstmp','$output');";
	    $resultEnvio = mysqli_query($conexionDatos, $gameRequestRequest);

	    // Una vez hecho esto, es hora
		// de hacer una respuesta basura para algunas respuestas que busca el juego
		if (array_key_exists('packet', $_POST)) {
			$peticionERDTV = json_decode($_POST['packet'], true);
			if (array_key_exists('content', $peticionERDTV)) {
				// WIP manipular datos de content en caso de que exista
			}
			if ($peticionERDTV['type'] === "getallsongs") {
				echo '{"result":"success","content":{"songs":[{"songid":"8CD48B7478B27A8",""cancion":"8CD48B7478B27A8","banda":"8CD48B69585718A","disco":"8CD48B69C780BCE","anio":2008,"dif_guitarra":3,"dif_bajo":2,"dif_bateria":2,"dif_voz":4,"dif_gral":2,"nombre_artista":"Intoxicados","nombre_cancion":"Pila Pila","nombre_album":"El Exilio de las Especies (Thend)","":""},{"songid":"8CD95C96F8BAC74","banda":"8CD95C93A5C0946","disco":"8CD95C95D3A661E","anio":2006,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":3,"dif_voz":2,"dif_gral":2,"nombre_artista":"Estelares","nombre_cancion":"aire","nombre_album":"Sistema Nervioso Central","":""},{"songid":"8CD95C98176C67B","banda":"8CD95C9489CA151","disco":"8CD95C965D0179B","anio":2007,"dif_guitarra":3,"dif_bajo":2,"dif_bateria":5,"dif_voz":3,"dif_gral":3,"nombre_artista":"Massacre","nombre_cancion":"La reina de marte","nombre_album":"El Mamut","":""},{"songid":"8CDA0A4B1CF5586","banda":"8CDA0A1DDF54308","disco":"8CDA0A45518C3B8","anio":2007,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":5,"dif_voz":3,"dif_gral":3,"nombre_artista":"El Otro Yo","nombre_cancion":"Locomotora","nombre_album":"Fuera Del Tiempo","":""},{"songid":"8CDBC42155FAA84","banda":"8CDBC41E81C85EC","disco":"8CDBC41EBE480A8","anio":2002,"dif_guitarra":4,"dif_bajo":2,"dif_bateria":4,"dif_voz":3,"dif_gral":3,"nombre_artista":"Kapanga","nombre_cancion":"Bisabuelo","nombre_album":"Botanika","":""},{"songid":"8CDC34E4BACDE96","banda":"8CDBC41E81C85EC","disco":"8CDBC41EBE480A8","anio":2002,"dif_guitarra":4,"dif_bajo":4,"dif_bateria":5,"dif_voz":3,"dif_gral":4,"nombre_artista":"Kapanga","nombre_cancion":"Fumar","nombre_album":"Botanika","":""},{"songid":"8CDCC0A173DEBC2","banda":"8CDCC09F777143A","disco":"8CDCC09FEEA6D7A","anio":2011,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":4,"dif_voz":3,"dif_gral":3,"nombre_artista":"Las Pelotas","nombre_cancion":"Bombachitas Rosas (Vivo)","nombre_album":"Vivo","":""},{"songid":"8CDCC0A2F8CA556","banda":"8CDCC09F777143A","disco":"8CDCC09FEEA6D7A","anio":2011,"dif_guitarra":2,"dif_bajo":3,"dif_bateria":4,"dif_voz":3,"dif_gral":3,"nombre_artista":"Las Pelotas","nombre_cancion":"Será (Vivo)","nombre_album":"Vivo","":""},{"songid":"8CDCCC8C8E87AF4","banda":"8CCE72136911694","disco":"8CDCCC8BFBE7104","anio":2004,"dif_guitarra":2,"dif_bajo":2,"dif_bateria":3,"dif_voz":2,"dif_gral":2,"nombre_artista":"Ratones Paranoicos","nombre_cancion":"Sigue Girando","nombre_album":"Girando","":""},{"songid":"8CDCCCD03E58666","banda":"8CD48B69585718A","disco":"8CD48B69C780BCE","anio":2008,"dif_guitarra":4,"dif_bajo":1,"dif_bateria":2,"dif_voz":3,"dif_gral":2,"nombre_artista":"Intoxicados","nombre_cancion":"Casi Sin Pensar","nombre_album":"El Exilio de las Especies (Thend)","":""},{"songid":"8CDD6DCFE601C6E","banda":"8CDD6DC3AB45E1A","disco":"8CDD6DCF44C6C0A","anio":2005,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":3,"dif_voz":2,"dif_gral":2,"nombre_artista":"Guasones","nombre_cancion":"Reyes de la Noche","nombre_album":"Toro Rojo","":""},{"songid":"8CDD6DEFECC65C0","banda":"8CE1A8C693B04BD","disco":"8CE1A8C8B2073CE","anio":2004,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":3,"dif_voz":2,"dif_gral":2,"nombre_artista":"Mancha de Rolando","nombre_cancion":"Arde la Ciudad","nombre_album":"Viaje","":""},{"songid":"8CDD6ED7C845AF0","banda":"8CDD6DF405D10C0","disco":"8CDD6ED5A3E8D30","anio":2004,"dif_guitarra":4,"dif_bajo":2,"dif_bateria":1,"dif_voz":2,"dif_gral":2,"nombre_artista":"Los Cafres","nombre_cancion":"Si el Amor se Cae","nombre_album":"Quién da Más","":""},{"songid":"8CDD6EF6F791BE6","banda":"8CDD6EF27BBB9D0","disco":"8CDD6EF6412DD96","anio":2008,"dif_guitarra":3,"dif_bajo":2,"dif_bateria":3,"dif_voz":2,"dif_gral":2,"nombre_artista":"Los Pericos","nombre_cancion":"Lindo Día","nombre_album":"Pura Vida","":""},{"songid":"8CDD6F088AAD4A0","banda":"8CDD6F05939C9C4","disco":"8CDD6F05F49E4A2","anio":2004,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":2,"dif_voz":2,"dif_gral":2,"nombre_artista":"Turf","nombre_cancion":"Pasos Al Costado","nombre_album":"Para Mí, Para Vos","":""},{"songid":"8CDD6F1907E0BB0","banda":"8CDCC0E7712CDFC","disco":"8CDD6F0E2E4D290","anio":2003,"dif_guitarra":3,"dif_bajo":2,"dif_bateria":3,"dif_voz":1,"dif_gral":2,"nombre_artista":"Los Autenticos Decadentes","nombre_cancion":"Un Osito de Peluche de Taiwán","nombre_album":"Sigue Tu Camino","":""},{"songid":"8CDDC8FE016675B","banda":"8CDCC0E7712CDFC","disco":"8CDD6F0E2E4D290","anio":2003,"dif_guitarra":4,"dif_bajo":3,"dif_bateria":4,"dif_voz":4,"dif_gral":3,"nombre_artista":"Los Autenticos Decadentes","nombre_cancion":"Sigue tu Camino","nombre_album":"Sigue Tu Camino","":""},{"songid":"8CDE834968849F4","banda":"8CDE8310FB32166","disco":"8CDE834639E08CB","anio":2011,"dif_guitarra":5,"dif_bajo":5,"dif_bateria":5,"dif_voz":4,"dif_gral":4,"nombre_artista":"Rata Blanca","nombre_cancion":"La Leyenda del Hada y el Mago","nombre_album":"XX Aniversario - Magos, Espadas y Rosas","":""},{"songid":"8CE0490F438236F","banda":"8CDFF1F17EDB389","disco":"8CE0490BF81053D","anio":2010,"dif_guitarra":1,"dif_bajo":2,"dif_bateria":4,"dif_voz":4,"dif_gral":2,"nombre_artista":"No Te Va Gustar","nombre_cancion":"Cero a La Izquierda","nombre_album":"Por lo Menos Hoy","":""},{"songid":"8CE04945F9BC04B","banda":"8CDFF1F17EDB389","disco":"8CE0490BF81053D","anio":2010,"dif_guitarra":2,"dif_bajo":1,"dif_bateria":2,"dif_voz":3,"dif_gral":2,"nombre_artista":"No Te Va Gustar","nombre_cancion":"Chau","nombre_album":"Por lo Menos Hoy","":""},{"songid":"8CE0DD7FB581131","banda":"8CE0DD7DD4A322D","disco":"8CE0DD7E45E5BF7","anio":2007,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":5,"dif_voz":5,"dif_gral":4,"nombre_artista":"Arbol","nombre_cancion":"Soy Vos","nombre_album":"Hormigas","":""},{"songid":"8CE0ED4DE9297DB","banda":"8CE0ED134FDDAF8","disco":"8CE0ED143F2508E","anio":2007,"dif_guitarra":4,"dif_bajo":3,"dif_bateria":3,"dif_voz":2,"dif_gral":3,"nombre_artista":"Ella es tan Cargosa","nombre_cancion":"Ni siquiera entre tus brazos","nombre_album":"Ella es tan cargosa","":""},{"songid":"8CE10377F16005B","banda":"8CE10374A7A0077","disco":"8CE1037563ACCFC","anio":2004,"dif_guitarra":4,"dif_bajo":3,"dif_bateria":3,"dif_voz":3,"dif_gral":3,"nombre_artista":"Los Tipitos","nombre_cancion":"Campanas en la noche","nombre_album":"Armando Camaleon","":""},{"songid":"8CE2C827256AFB3","banda":"8CD95C9489CA151","disco":"8CE2C8260DE89BD","anio":2011,"dif_guitarra":3,"dif_bajo":3,"dif_bateria":3,"dif_voz":2,"dif_gral":2,"nombre_artista":"Massacre","nombre_cancion":"Tanto Amor","nombre_album":"Ringo","":""},{"songid":"8CE3F8917CBAB8B","banda":"8CDE8310FB32166","disco":"8CE3F88FDD18EF8","anio":2008,"dif_guitarra":4,"dif_bajo":3,"dif_bateria":2,"dif_voz":3,"dif_gral":3,"nombre_artista":"Rata Blanca","nombre_cancion":"El Reino Olvidado","nombre_album":"El Reino Olvidado","":""},{"songid":"8CE4A8315DFA2C3","banda":"8CDD6DF405D10C0","disco":"8CE4A824D46CAA3","anio":2011,"dif_guitarra":2,"dif_bajo":4,"dif_bateria":1,"dif_voz":3,"dif_gral":2,"nombre_artista":"Los Cafres","nombre_cancion":"Casi q\' me pierdo","nombre_album":"El paso gigante","":""},{"songid":"8CE687319F49157","banda":"8CE6872FE67F497","disco":"8CE68730D8D0FA7","anio":2011,"dif_guitarra":3,"dif_bajo":4,"dif_bateria":2,"dif_voz":5,"dif_gral":3,"nombre_artista":"Viejas Locas","nombre_cancion":"Roca & giro","nombre_album":"Contra la pared","":""},{"songid":"8CEFBFAA71A3518","banda":"8CEFBFA6FD09CC8","disco":"8CEFBFA72916A78","anio":2012,"dif_guitarra":4,"dif_bajo":3,"dif_bateria":3,"dif_voz":3,"dif_gral":3,"nombre_artista":"Oconnor","nombre_cancion":"Yo Caníbal","nombre_album":"Un Poco de Respeto","":""}],"sessionid":"1"}}';
			} elseif ($peticionERDTV['type'] === "getauthorizedsongs") {
				//echo '{"result":"success","content":{"userid":"000001","sessionid":"1","songs":[{"songid":"8CD48B7478B27A8","hash":"8CD48B69585718A"},{"songid":"8CD95C96F8BAC74","hash":"8CD95C93A5C0946"},{"songid":"8CD95C98176C67B","hash":"8CD95C9489CA151"},{"songid":"8CDA0A4B1CF5586","hash":"8CDA0A1DDF54308"},{"songid":"8CDBC42155FAA84","hash":"8CDBC41E81C85EC"},{"songid":"8CDC34E4BACDE96","hash":"8CDBC41E81C85EC"},{"songid":"8CDCC0A173DEBC2","hash":"8CDCC09F777143A"},{"songid":"8CDCC0A2F8CA556","hash":"8CDCC09F777143A"},{"songid":"8CDCCC8C8E87AF4","hash":"8CCE72136911694"},{"songid":"8CDCCCD03E58666","hash":"8CD48B69585718A"},{"songid":"8CDD6DCFE601C6E","hash":"8CDD6DC3AB45E1A"},{"songid":"8CDD6DEFECC65C0","hash":"8CE1A8C693B04BD"},{"songid":"8CDD6ED7C845AF0","hash":"8CDD6DF405D10C0"},{"songid":"8CDD6EF6F791BE6","hash":"8CDD6EF27BBB9D0"},{"songid":"8CDD6F088AAD4A0","hash":"8CDD6F05939C9C4"},{"songid":"8CDD6F1907E0BB0","hash":"8CDCC0E7712CDFC"},{"songid":"8CDDC8FE016675B","hash":"8CDCC0E7712CDFC"},{"songid":"8CDE834968849F4","hash":"8CDE8310FB32166"},{"songid":"8CE0490F438236F","hash":"8CDFF1F17EDB389"},{"songid":"8CE04945F9BC04B","hash":"8CDFF1F17EDB389"},{"songid":"8CE0DD7FB581131","hash":"8CE0DD7DD4A322D"},{"songid":"8CE0ED4DE9297DB","hash":"8CE0ED134FDDAF8"},{"songid":"8CE10377F16005B","hash":"8CE10374A7A0077"},{"songid":"8CE2C827256AFB3","hash":"8CD95C9489CA151"},{"songid":"8CE3F8917CBAB8B","hash":"8CDE8310FB32166"},{"songid":"8CE4A8315DFA2C3","hash":"8CDD6DF405D10C0"},{"songid":"8CE687319F49157","hash":"8CE6872FE67F497"},{"songid":"8CEFBFAA71A3518","hash":"8CEFBFA6FD09CC8"}]}}';
				echo '{"result":"success","content":{"userid":"000001","sessionid":"1","songs":[{"songid":"8CD48B7478B27A8","hash":"3D8BB7310EC837488DEB105C5B0B384A"}]}}';
			} elseif ($peticionERDTV['type'] === "login") {
				echo '{"result":"success","content":{"userid":"000001","sessionid":"1"}}';
			} elseif ($peticionERDTV['type'] === "logout") {
				echo '{"result":"success","content":{"userid":"000001","sessionid":"1"}}';
			} elseif ($peticionERDTV['type'] === "getads") {
				// Rompiendo el server just to feel something
				echo '{"result":"success","content":{"adverts":[{"hash":"9e2f1b4160cef7d99db310251ec7ef07","server":"https://raw.githubusercontent.com/","path":"eldainosor/ElServerDeMiVida/main/img/sepuede_parca.jpg","place":"https://gitlab.com/envido32/todoelrock"}]}}';
			} elseif ($peticionERDTV['type'] === "lorem") {
				// ACTUALIZAR ESTO UNA VEZ QUE DEJEMOS DE JUGAR
			} else {
				echo '{"result":"other"}';
			}
		} else {
			echo '{"result":"needupgrade"}';
		}
	}
?>